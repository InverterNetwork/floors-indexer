# Core Types & Conventions
# Note: Amount type removed - Envio requires entities to have id fields
# Monetary values are stored as {field}Raw: BigInt! and {field}Formatted: String!

type Token {
  id: ID!
  name: String!
  symbol: String!
  decimals: Int!
}

enum MarketStatus {
  ACTIVE
  PAUSED
  CLOSED
}

enum TradeType {
  BUY
  SELL
}

enum LoanStatus {
  ACTIVE
  REPAID
  DEFAULTED
}

enum StakeStatus {
  ACTIVE
  UNSTAKED
  LOCKED
}

enum CandlePeriod {
  ONE_HOUR
  FOUR_HOURS
  ONE_DAY
}

# User Group (Query only when wallet connected)
type Account {
  id: ID!
  marketsCreated: [Market!]! @derivedFrom(field: "creator")
  trades: [Trade!]! @derivedFrom(field: "user")
  loans: [Loan!]! @derivedFrom(field: "borrower")
  stakes: [Stake!]! @derivedFrom(field: "user")
  presaleParticipations: [PresaleParticipation!]! @derivedFrom(field: "user")
  userMarketPositions: [UserMarketPosition!]! @derivedFrom(field: "user")
}

type UserMarketPosition {
  id: ID!
  user: Account!
  market: Market!
  fTokenBalanceRaw: BigInt!
  fTokenBalanceFormatted: String!
  reserveBalanceRaw: BigInt!
  reserveBalanceFormatted: String!
  totalDebtRaw: BigInt!
  totalDebtFormatted: String!
  lockedCollateralRaw: BigInt!
  lockedCollateralFormatted: String!
  stakedAmountRaw: BigInt!
  stakedAmountFormatted: String!
  claimableRewardsRaw: BigInt!
  claimableRewardsFormatted: String!
  presaleDepositRaw: BigInt!
  presaleDepositFormatted: String!
  presaleLeverage: BigInt!
  lastUpdatedAt: BigInt!
}

type UserPortfolioSummary {
  id: ID!
  user_id: ID!
  totalPortfolioValueRaw: BigInt!
  totalPortfolioValueFormatted: String!
  totalDebtRaw: BigInt!
  totalDebtFormatted: String!
  totalCollateralValueRaw: BigInt!
  totalCollateralValueFormatted: String!
  totalStakedValueRaw: BigInt!
  totalStakedValueFormatted: String!
  activeMarkets: BigInt!
  activeLoans: BigInt!
  activeStakes: BigInt!
  lastUpdatedAt: BigInt!
}

# Static Group (Fetch once, cache client-side)
type Market {
  id: ID!
  name: String!
  symbol: String!
  description: String!
  creator: Account!
  factory: FactoryContract!
  reserveToken: Token!
  issuanceToken: Token!
  initialPriceRaw: BigInt!
  initialPriceFormatted: String!
  tradingFeeBps: BigInt!
  maxLTV: BigInt!
  maxSupplyRaw: BigInt!
  maxSupplyFormatted: String!
  createdAt: BigInt!
  trades: [Trade!]! @derivedFrom(field: "market")
  floorElevations: [FloorElevation!]! @derivedFrom(field: "market")
  feeDistributions: [FeeDistribution!]! @derivedFrom(field: "market")
}

type ModuleRegistry {
  id: ID!
  market_id: ID!
  fundingManager: String!
  authorizer: String!
  feeTreasury: String!
  creditFacility: String
  presale: String
  staking: String
  createdAt: BigInt!
  lastUpdatedAt: BigInt!
}

type FactoryContract {
  id: ID!
  totalMarkets: BigInt!
  creationFeeRaw: BigInt!
  creationFeeFormatted: String!
  feeCollector: String!
  createdAt: BigInt!
  markets: [Market!]! @derivedFrom(field: "factory")
}

type CreditFacilityContract {
  id: ID!
  collateralToken: Token!
  borrowToken: Token!
  totalLoans: BigInt!
  totalVolumeRaw: BigInt!
  totalVolumeFormatted: String!
  createdAt: BigInt!
  loans: [Loan!]! @derivedFrom(field: "facility")
}

type StakingContract {
  id: ID!
  stakingToken: Token!
  rewardToken: Token!
  totalStakedRaw: BigInt!
  totalStakedFormatted: String!
  totalRewardsRaw: BigInt!
  totalRewardsFormatted: String!
  createdAt: BigInt!
  stakes: [Stake!]! @derivedFrom(field: "contract")
}

type PreSaleContract {
  id: ID!
  saleToken: Token!
  purchaseToken: Token!
  startTime: BigInt!
  endTime: BigInt!
  maxLeverage: BigInt!
  totalRaisedRaw: BigInt!
  totalRaisedFormatted: String!
  totalParticipants: BigInt!
  createdAt: BigInt!
  participations: [PresaleParticipation!]! @derivedFrom(field: "presale")
}

# Dynamic Group (Poll frequently, small payloads)
type MarketState {
  id: ID!
  market_id: ID!
  currentPriceRaw: BigInt!
  currentPriceFormatted: String!
  floorPriceRaw: BigInt!
  floorPriceFormatted: String!
  totalSupplyRaw: BigInt!
  totalSupplyFormatted: String!
  marketSupplyRaw: BigInt!
  marketSupplyFormatted: String!
  floorSupplyRaw: BigInt!
  floorSupplyFormatted: String!
  status: MarketStatus!
  isBuyOpen: Boolean!
  isSellOpen: Boolean!
  lastTradeTimestamp: BigInt!
  lastElevationTimestamp: BigInt!
  lastUpdatedAt: BigInt!
}

type Trade {
  id: ID!
  market: Market!
  user: Account!
  tradeType: TradeType!
  tokenAmountRaw: BigInt!
  tokenAmountFormatted: String!
  reserveAmountRaw: BigInt!
  reserveAmountFormatted: String!
  feeRaw: BigInt!
  feeFormatted: String!
  newPriceRaw: BigInt!
  newPriceFormatted: String!
  timestamp: BigInt!
  transactionHash: String!
}

type FloorElevation {
  id: ID!
  market: Market!
  oldFloorPriceRaw: BigInt!
  oldFloorPriceFormatted: String!
  newFloorPriceRaw: BigInt!
  newFloorPriceFormatted: String!
  deployedAmountRaw: BigInt!
  deployedAmountFormatted: String!
  timestamp: BigInt!
  transactionHash: String!
}

type FeeDistribution {
  id: ID!
  market: Market!
  floorAmountRaw: BigInt!
  floorAmountFormatted: String!
  stakingAmountRaw: BigInt!
  stakingAmountFormatted: String!
  treasuryAmountRaw: BigInt!
  treasuryAmountFormatted: String!
  timestamp: BigInt!
  transactionHash: String!
}

type Loan {
  id: ID!
  borrower: Account!
  facility: CreditFacilityContract!
  collateralAmountRaw: BigInt!
  collateralAmountFormatted: String!
  borrowAmountRaw: BigInt!
  borrowAmountFormatted: String!
  originationFeeRaw: BigInt!
  originationFeeFormatted: String!
  status: LoanStatus!
  timestamp: BigInt!
  transactionHash: String!
}

type Stake {
  id: ID!
  user: Account!
  contract: StakingContract!
  amountRaw: BigInt!
  amountFormatted: String!
  lockDuration: BigInt!
  status: StakeStatus!
  timestamp: BigInt!
  transactionHash: String!
}

type PresaleParticipation {
  id: ID!
  user: Account!
  presale: PreSaleContract!
  amountRaw: BigInt!
  amountFormatted: String!
  leverage: BigInt!
  timestamp: BigInt!
  transactionHash: String!
}

type MarketSnapshot {
  id: ID!
  market: Market!
  timestamp: BigInt!
  priceRaw: BigInt!
  priceFormatted: String!
  floorPriceRaw: BigInt!
  floorPriceFormatted: String!
  totalSupplyRaw: BigInt!
  totalSupplyFormatted: String!
  marketSupplyRaw: BigInt!
  marketSupplyFormatted: String!
  volume24hRaw: BigInt!
  volume24hFormatted: String!
  trades24h: BigInt!
}

type PriceCandle {
  id: ID!
  market: Market!
  period: CandlePeriod!
  timestamp: BigInt!
  openRaw: BigInt!
  openFormatted: String!
  highRaw: BigInt!
  highFormatted: String!
  lowRaw: BigInt!
  lowFormatted: String!
  closeRaw: BigInt!
  closeFormatted: String!
  volumeRaw: BigInt!
  volumeFormatted: String!
  trades: BigInt!
}

